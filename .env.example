# =============================================================================
# ARGUS E2E TESTING AGENT - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values
# NEVER commit .env to git (it contains secrets)
# =============================================================================

# =============================================================================
# OPENROUTER - THE ONLY API KEY YOU NEED
# =============================================================================
# OpenRouter provides access to 300+ models via ONE API key:
# - DeepSeek, Claude, GPT, Llama, Qwen, Gemini, and more
# - No markup on provider pricing (just 5.5% platform fee)
# - Automatic failover between providers
# - Get your key at: https://openrouter.ai/keys

OPENROUTER_API_KEY=sk-or-v1-...

# =============================================================================
# SUPABASE (Database & Auth)
# =============================================================================
# Create a project at: https://supabase.com/dashboard

SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGci...
SUPABASE_ANON_KEY=eyJhbGci...

# PostgreSQL connection (for LangGraph persistence)
DATABASE_URL=postgresql://postgres:[password]@db.[project-ref].supabase.co:5432/postgres

# =============================================================================
# CLERK (Dashboard Authentication)
# =============================================================================
# Configure at: https://dashboard.clerk.com

CLERK_JWKS_URL=https://your-instance.clerk.accounts.dev/.well-known/jwks.json

# =============================================================================
# BROWSER POOL (Vultr K8s - RECOMMENDED)
# =============================================================================
# Primary browser automation infrastructure - scalable, cost-effective
# See browser-pool/kubernetes/KEDA-DEPLOYMENT-GUIDE.md for setup
#
# Priority order:
# 1. BROWSER_POOL_URL (Vultr K8s) - Production, scalable
# 2. BROWSER_WORKER_URL (Cloudflare) - Legacy fallback
# 3. http://localhost:8080 - Local development

BROWSER_POOL_URL=https://browser-pool.your-domain.com
BROWSER_POOL_JWT_SECRET=generate-with-openssl-rand-hex-64

# Timeouts and retries
BROWSER_TIMEOUT_MS=60000
BROWSER_RETRY_COUNT=3

# Claude Computer Use fallback (when DOM execution fails)
VISION_FALLBACK_ENABLED=true

# =============================================================================
# SELENIUM GRID (Video Recording)
# =============================================================================
# Separate from browser-pool, used specifically for video recording sessions.
# Runs on Vultr K8s with ffmpeg sidecars that auto-upload to R2.
# See browser-pool/selenium-grid/values-with-video.yaml for setup.

SELENIUM_GRID_URL=http://65.20.71.218:4444

# =============================================================================
# BROWSER AUTOMATION - LEGACY (Cloudflare Worker)
# =============================================================================
# Fallback if BROWSER_POOL_URL is not set
# Deploy your own: cd cloudflare-worker && npm run deploy

BROWSER_WORKER_URL=https://argus-api.samuelvinay-kumar.workers.dev

# =============================================================================
# CLOUDFLARE STORAGE (Optional - for artifacts)
# =============================================================================

CLOUDFLARE_API_TOKEN=
CLOUDFLARE_ACCOUNT_ID=
CLOUDFLARE_WORKER_URL=https://your-worker.workers.dev  # Key Vault encryption service URL
CLOUDFLARE_R2_BUCKET=argus-artifacts

# R2 S3-compatible credentials for presigned URLs (optional but recommended)
# Generate these at: Cloudflare Dashboard > R2 > Manage R2 API Tokens
CLOUDFLARE_R2_ACCESS_KEY_ID=
CLOUDFLARE_R2_SECRET_ACCESS_KEY=
CLOUDFLARE_R2_PRESIGNED_URL_EXPIRY=3600

# =============================================================================
# COST CONTROLS
# =============================================================================

COST_LIMIT_PER_RUN=10.00
COST_LIMIT_PER_TEST=1.00

# =============================================================================
# EXECUTION SETTINGS
# =============================================================================

PARALLEL_TESTS=1
RETRY_FAILED_TESTS=2
SELF_HEAL_ENABLED=true
SELF_HEAL_CONFIDENCE_THRESHOLD=0.8

# =============================================================================
# SERVER SETTINGS
# =============================================================================

SERVER_HOST=0.0.0.0
SERVER_PORT=8000
ARGUS_BACKEND_URL=http://localhost:8000

# =============================================================================
# SECURITY (Production)
# =============================================================================

ENFORCE_AUTHENTICATION=false
JWT_SECRET_KEY=generate-with-openssl-rand-hex-32
RATE_LIMITING_ENABLED=true
CORS_ALLOWED_ORIGINS=*
AUDIT_LOGGING_ENABLED=true

# =============================================================================
# SENTRY (Error Monitoring & Performance)
# =============================================================================
# Create a project at: https://sentry.io
# Get DSN from: Project Settings > Client Keys (DSN)

SENTRY_DSN=https://your-public-key@o123456.ingest.sentry.io/project-id
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1
SENTRY_SEND_DEFAULT_PII=false
SENTRY_DEBUG=false

# =============================================================================
# VCS WEBHOOKS (GitHub & GitLab)
# =============================================================================
# Webhook secrets for signature/token verification

# GitHub Webhook Secret
# Configure at: Repository Settings > Webhooks > Add webhook > Secret
# Generate with: openssl rand -hex 32
GITHUB_WEBHOOK_SECRET=

# GitLab Webhook Token
# Configure at: Project Settings > Webhooks > Secret token
# Generate with: openssl rand -hex 32
GITLAB_WEBHOOK_TOKEN=

# =============================================================================
# OAUTH INTEGRATIONS
# =============================================================================
# Configure OAuth apps for third-party integrations (GitHub, Slack, Jira, Linear)

# GitHub OAuth App (https://github.com/settings/developers)
# Scopes: repo, read:org
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# Slack OAuth App (https://api.slack.com/apps)
# Scopes: channels:read, chat:write, users:read
SLACK_CLIENT_ID=
SLACK_CLIENT_SECRET=

# Jira OAuth 2.0 3LO (https://developer.atlassian.com/console/myapps/)
# Scopes: read:jira-work, write:jira-work, read:jira-user, offline_access
JIRA_CLIENT_ID=
JIRA_CLIENT_SECRET=

# Linear OAuth (https://linear.app/settings/api)
# Scopes: read, write, issues:create, comments:create
LINEAR_CLIENT_ID=
LINEAR_CLIENT_SECRET=

# OAuth token encryption key (32 bytes, base64 encoded)
# Generate with: openssl rand -base64 32
OAUTH_ENCRYPTION_KEY=

# OAuth redirect base URL (your dashboard URL)
OAUTH_REDIRECT_BASE_URL=http://localhost:3000

# =============================================================================
# REDPANDA (Event Streaming)
# =============================================================================
# Kafka-compatible event streaming platform
#
# Options:
# 1. Redpanda Serverless (Recommended for testing)
#    - Sign up: https://redpanda.com/redpanda-cloud/serverless
#    - Get $300 free via AWS Marketplace
#
# 2. Self-hosted K8s
#    - Local: localhost:19092
#    - K8s: redpanda-kafka.argus-data.svc.cluster.local:9092

# Redpanda Serverless (update with your cluster URL)
REDPANDA_BROKERS=<cluster-id>.any.<region>.mpx.prd.cloud.redpanda.com:9092
REDPANDA_SASL_USERNAME=argus-service
REDPANDA_SASL_PASSWORD=
REDPANDA_SASL_MECHANISM=SCRAM-SHA-256
REDPANDA_SECURITY_PROTOCOL=SASL_SSL

# Schema Registry (optional, for Avro schemas)
REDPANDA_SCHEMA_REGISTRY_URL=http://redpanda-schema-registry.argus-data.svc.cluster.local:8081

# =============================================================================
# FALKORDB (Knowledge Graphs)
# =============================================================================
# Graph database for Cognee knowledge storage
# Local: localhost:6379, K8s: falkordb.argus-data.svc.cluster.local:6379

FALKORDB_HOST=falkordb.argus-data.svc.cluster.local
FALKORDB_PORT=6379
FALKORDB_PASSWORD=

# =============================================================================
# VALKEY (Cache - Redis Replacement)
# =============================================================================
# BSD-3-Clause licensed Redis replacement
# Local: localhost:6380, K8s: valkey.argus-data.svc.cluster.local:6379

VALKEY_URL=redis://valkey.argus-data.svc.cluster.local:6379

# =============================================================================
# FLINK (Stream Processing)
# =============================================================================
# Apache Flink JobManager REST API for health checks
# K8s: http://flink-webui.argus-data.svc.cluster.local:8081

FLINK_JOBMANAGER_URL=http://flink-webui.argus-data.svc.cluster.local:8081

# =============================================================================
# GRAFANA (Visualization)
# =============================================================================
# Grafana dashboard for infrastructure health checks
# K8s: http://grafana.monitoring.svc.cluster.local:3000

GRAFANA_URL=http://grafana.monitoring.svc.cluster.local:3000

# =============================================================================
# COGNEE (AI Memory)
# =============================================================================
# ECL pipeline for codebase analysis and knowledge graph construction

COGNEE_ENV=production
VECTOR_DB_PROVIDER=pgvector
GRAPH_DATABASE_PROVIDER=falkordb
LLM_PROVIDER=openrouter
LLM_MODEL=anthropic/claude-sonnet-4

# =============================================================================
# LEGACY/OPTIONAL - Direct provider keys (not needed with OpenRouter)
# =============================================================================
# Only set these if you need direct provider access for specific use cases

# ANTHROPIC_API_KEY=sk-ant-...      # Direct Claude (Computer Use may have lower latency)
# OPENAI_API_KEY=sk-...             # Direct OpenAI
# GOOGLE_API_KEY=AIza...            # Direct Gemini
# GROQ_API_KEY=gsk_...              # Ultra-fast Llama (if needed)
