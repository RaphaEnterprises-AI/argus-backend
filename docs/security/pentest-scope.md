# Penetration Testing Scope Document

**Document Version**: 1.0
**Last Updated**: 2026-01-22
**Classification**: CONFIDENTIAL - For Authorized Security Testing Only

---

## Executive Summary

This document defines the scope and attack surface for penetration testing of the Argus E2E Testing Agent platform. The application is a multi-tenant SaaS platform for autonomous end-to-end testing with AI capabilities.

---

## Table of Contents

1. [Architecture Overview](#architecture-overview)
2. [API Endpoint Inventory](#api-endpoint-inventory)
3. [Authentication Mechanisms](#authentication-mechanisms)
4. [User Roles & Permissions](#user-roles--permissions)
5. [Security Controls](#security-controls)
6. [Testing Scope](#testing-scope)
7. [Attack Surface Analysis](#attack-surface-analysis)

---

## Architecture Overview

### Components In Scope

| Component | Technology | URL Pattern | Notes |
|-----------|------------|-------------|-------|
| **Backend API** | Python (FastAPI) | `https://argus-brain-production.up.railway.app/api/v1/*` | Main API surface |
| **Dashboard** | Next.js | `https://heyargus.ai/*` | Web application |
| **Cloudflare Worker** | TypeScript | `https://argus-api.samuelvinay-kumar.workers.dev/*` | Edge functions, BYOK encryption |
| **Browser Pool** | Kubernetes | `https://browser-pool.heyargus.ai/*` | Isolated browser instances |

### Database & Storage

| Service | Provider | Purpose |
|---------|----------|---------|
| PostgreSQL | Supabase | Primary database, RLS enforced |
| R2 Storage | Cloudflare | Artifacts (screenshots, videos) |
| KV Storage | Cloudflare | Session caching |
| Vectorize | Cloudflare | Semantic search embeddings |

---

## API Endpoint Inventory

### Total Endpoints: 320

### Authentication & Authorization (14 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/auth/device/authorize` | Device auth initiation | No |
| POST | `/api/v1/auth/device/token` | Token polling | No |
| GET | `/api/v1/auth/device/verify` | Verification page | No |
| POST | `/api/v1/auth/device/verify` | Submit user code | Session |
| POST | `/api/v1/auth/device/approve` | Approve device | Session |
| POST | `/api/v1/auth/device/refresh` | Refresh token | Refresh Token |
| GET | `/api/v1/auth/me` | Current user info | Yes |
| GET | `/api/v1/auth/debug-token` | Token debugging | Yes |
| GET | `/api/v1/security/info` | Security configuration | Yes |
| GET | `/api/v1/organizations/{org_id}/keys` | List API keys | Yes |
| POST | `/api/v1/organizations/{org_id}/keys` | Create API key | Yes |
| POST | `/api/v1/organizations/{org_id}/keys/{key_id}/rotate` | Rotate key | Yes |
| DELETE | `/api/v1/organizations/{org_id}/keys/{key_id}` | Revoke key | Yes |

### User Management (10 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/users/me` | Get profile | Yes |
| PUT | `/api/v1/users/me` | Update profile | Yes |
| PATCH | `/api/v1/users/me` | Partial update | Yes |
| GET | `/api/v1/users/me/preferences` | Get preferences | Yes |
| PUT | `/api/v1/users/me/preferences` | Update preferences | Yes |
| PUT | `/api/v1/users/me/test-defaults` | Set test defaults | Yes |
| PUT | `/api/v1/users/me/discovery-preferences` | Discovery prefs | Yes |
| POST | `/api/v1/users/me/default-organization` | Set default org | Yes |
| GET | `/api/v1/users/me/organizations` | List user orgs | Yes |
| POST | `/api/v1/users/me/organizations/{org_id}/switch` | Switch org | Yes |

### Organization & Team Management (18 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/organizations` | List organizations | Yes |
| POST | `/api/v1/organizations` | Create organization | Yes |
| GET | `/api/v1/organizations/{org_id}` | Get organization | Yes |
| PUT | `/api/v1/organizations/{org_id}` | Update organization | Yes |
| DELETE | `/api/v1/organizations/{org_id}` | Delete organization | Yes |
| POST | `/api/v1/organizations/{org_id}/transfer` | Transfer ownership | Yes |
| GET | `/api/v1/organizations/{org_id}/members` | List members | Yes |
| POST | `/api/v1/organizations/{org_id}/members/invite` | Invite member | Yes |
| PATCH | `/api/v1/organizations/{org_id}/members/{member_id}/role` | Change role | Yes |
| DELETE | `/api/v1/organizations/{org_id}/members/{member_id}` | Remove member | Yes |
| POST | `/api/v1/invitations/organizations/{org_id}/invitations` | Create invitation | Yes |
| GET | `/api/v1/invitations/organizations/{org_id}/invitations` | List invitations | Yes |
| DELETE | `/api/v1/invitations/organizations/{org_id}/invitations/{invite_id}` | Cancel invitation | Yes |
| GET | `/api/v1/invitations/validate/{token}` | Validate invite token | No |
| POST | `/api/v1/invitations/accept/{token}` | Accept invitation | Session |

### Project Management (9 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/organizations/{org_id}/projects` | List org projects | Yes |
| POST | `/api/v1/organizations/{org_id}/projects` | Create in org | Yes |
| GET | `/api/v1/projects` | List all projects | Yes |
| POST | `/api/v1/projects` | Create project | Yes |
| GET | `/api/v1/projects/{project_id}` | Get project | Yes |
| PUT | `/api/v1/projects/{project_id}` | Update project | Yes |
| PATCH | `/api/v1/projects/{project_id}` | Partial update | Yes |
| DELETE | `/api/v1/projects/{project_id}` | Delete project | Yes |

### Test Management (24 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/tests` | List tests (paginated) | Yes |
| POST | `/api/v1/tests` | Create test | Yes |
| GET | `/api/v1/tests/{test_id}` | Get test | Yes |
| PUT | `/api/v1/tests/{test_id}` | Update test | Yes |
| PATCH | `/api/v1/tests/{test_id}` | Partial update | Yes |
| DELETE | `/api/v1/tests/{test_id}` | Delete test | Yes |
| POST | `/api/v1/tests/bulk-delete` | Bulk delete | Yes |
| POST | `/api/v1/tests/bulk-update` | Bulk update | Yes |
| POST | `/api/v1/tests/run` | Execute test run | Yes |
| POST | `/api/v1/tests/create` | NLP test creation | Yes |
| GET | `/api/v1/jobs/{job_id}` | Job status | Yes |
| GET | `/api/v1/jobs` | List jobs | Yes |

### Parameterized Testing (17 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/parameterized/expand` | Expand parameters | Yes |
| POST | `/api/v1/parameterized/preview` | Preview expansion | Yes |
| POST | `/api/v1/parameterized/validate` | Validate parameters | Yes |
| POST | `/api/v1/parameterized/import-data` | Import test data | Yes |
| POST | `/api/v1/parameterized/import-data/upload` | Upload data file | Yes |
| GET | `/api/v1/parameterized/data-sources` | List data sources | Yes |
| GET | `/api/v1/parameterized/iteration-modes` | List iteration modes | Yes |
| POST | `/api/v1/parameterized/tests` | Create param test | Yes |
| GET | `/api/v1/parameterized/tests` | List param tests | Yes |
| GET | `/api/v1/parameterized/tests/{test_id}` | Get param test | Yes |
| PATCH | `/api/v1/parameterized/tests/{test_id}` | Update param test | Yes |
| DELETE | `/api/v1/parameterized/tests/{test_id}` | Delete param test | Yes |
| POST | `/api/v1/parameterized/tests/{test_id}/parameter-sets` | Add param set | Yes |
| GET | `/api/v1/parameterized/tests/{test_id}/parameter-sets` | List param sets | Yes |
| DELETE | `/api/v1/parameterized/tests/{test_id}/parameter-sets` | Delete param sets | Yes |
| GET | `/api/v1/parameterized/tests/{test_id}/results` | Get results | Yes |
| POST | `/api/v1/parameterized/tests/{test_id}/execute` | Execute test | Yes |

### Scheduling (12 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/schedules` | Create schedule | Yes |
| GET | `/api/v1/schedules` | List schedules | Yes |
| GET | `/api/v1/schedules/{schedule_id}` | Get schedule | Yes |
| PATCH | `/api/v1/schedules/{schedule_id}` | Update schedule | Yes |
| DELETE | `/api/v1/schedules/{schedule_id}` | Delete schedule | Yes |
| POST | `/api/v1/schedules/{schedule_id}/trigger` | Manual trigger | Yes |
| GET | `/api/v1/schedules/{schedule_id}/runs` | List runs | Yes |
| GET | `/api/v1/schedules/{schedule_id}/runs/{run_id}` | Get run | Yes |
| POST | `/api/v1/schedules/{schedule_id}/runs/{run_id}/cancel` | Cancel run | Yes |
| POST | `/api/v1/schedules/validate-cron` | Validate cron | Yes |
| GET | `/api/v1/schedules/presets` | Get presets | Yes |

### Discovery Engine (28 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/discovery/sessions` | List sessions | Yes |
| POST | `/api/v1/discovery/sessions` | Create session | Yes |
| GET | `/api/v1/discovery/sessions/{session_id}` | Get session | Yes |
| GET | `/api/v1/discovery/sessions/{session_id}/stream` | SSE stream | Yes |
| POST | `/api/v1/discovery/sessions/{session_id}/pause` | Pause session | Yes |
| POST | `/api/v1/discovery/sessions/{session_id}/resume` | Resume session | Yes |
| POST | `/api/v1/discovery/sessions/{session_id}/cancel` | Cancel session | Yes |
| DELETE | `/api/v1/discovery/sessions/{session_id}` | Delete session | Yes |
| GET | `/api/v1/discovery/sessions/{session_id}/pages` | List pages | Yes |
| GET | `/api/v1/discovery/sessions/{session_id}/pages/{page_id}` | Get page | Yes |
| GET | `/api/v1/discovery/sessions/{session_id}/flows` | List flows | Yes |
| PUT | `/api/v1/discovery/flows/{flow_id}` | Update flow | Yes |
| POST | `/api/v1/discovery/flows/{flow_id}/validate` | Validate flow | Yes |
| POST | `/api/v1/discovery/flows/{flow_id}/generate-test` | Generate test | Yes |
| GET | `/api/v1/discovery/projects/{project_id}/history` | Discovery history | Yes |
| GET | `/api/v1/discovery/projects/{project_id}/compare` | Compare sessions | Yes |
| GET | `/api/v1/discovery/patterns` | List patterns | Yes |
| POST | `/api/v1/discovery/patterns` | Create pattern | Yes |
| POST | `/api/v1/discovery/patterns/extract` | Extract patterns | Yes |
| POST | `/api/v1/discovery/patterns/search` | Search patterns | Yes |
| GET | `/api/v1/discovery/patterns/insights` | Pattern insights | Yes |
| POST | `/api/v1/discovery/patterns/update-success` | Update success | Yes |
| GET | `/api/v1/discovery/patterns/types` | Pattern types | Yes |
| POST | `/api/v1/discovery/feature-mesh/process` | Process mesh | Yes |
| POST | `/api/v1/discovery/feature-mesh/create-baselines` | Create baselines | Yes |
| POST | `/api/v1/discovery/feature-mesh/share-selectors` | Share selectors | Yes |
| POST | `/api/v1/discovery/feature-mesh/healing-feedback` | Healing feedback | Yes |
| GET | `/api/v1/discovery/feature-mesh/selector-alternatives` | Alt selectors | Yes |

### Visual AI Testing (23 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/visual/capture` | Capture snapshot | Yes |
| POST | `/api/v1/visual/responsive/capture` | Multi-viewport | Yes |
| POST | `/api/v1/visual/browsers/capture` | Multi-browser | Yes |
| POST | `/api/v1/visual/compare` | Compare snapshots | Yes |
| POST | `/api/v1/visual/responsive/compare` | Multi-viewport compare | Yes |
| POST | `/api/v1/visual/browsers/compare` | Multi-browser compare | Yes |
| POST | `/api/v1/visual/analyze` | AI analysis | Yes |
| POST | `/api/v1/visual/accessibility/analyze` | A11y analysis | Yes |
| POST | `/api/v1/visual/baselines` | Create baseline | Yes |
| GET | `/api/v1/visual/baselines/{baseline_id}` | Get baseline | Yes |
| GET | `/api/v1/visual/baselines/{baseline_id}/history` | Baseline history | Yes |
| GET | `/api/v1/visual/baselines` | List baselines | Yes |
| POST | `/api/v1/visual/comparisons/{comparison_id}/approve` | Approve diff | Yes |
| POST | `/api/v1/visual/comparisons/{comparison_id}/reject` | Reject diff | Yes |
| POST | `/api/v1/visual/ai/explain` | AI explanation | Yes |
| GET | `/api/v1/visual/comparisons` | List comparisons | Yes |
| GET | `/api/v1/visual/comparisons/{comparison_id}` | Get comparison | Yes |
| GET | `/api/v1/visual/snapshots/{snapshot_id}` | Get snapshot | Yes |

### Quality & AI (14 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/quality/generate-test` | AI test gen | Yes |
| POST | `/api/v1/quality/batch-generate` | Batch generation | Yes |
| POST | `/api/v1/quality/update-test` | Update test | Yes |
| POST | `/api/v1/quality/calculate-risk` | Risk calculation | Yes |
| GET | `/api/v1/quality/events` | Quality events | Yes |
| GET | `/api/v1/quality/stats` | Quality stats | Yes |
| GET | `/api/v1/quality/risk-scores` | Risk scores | Yes |
| GET | `/api/v1/quality/generated-tests` | Generated tests | Yes |
| GET | `/api/v1/quality/score` | Quality score | Yes |
| GET | `/api/v1/quality/similar-errors` | Similar errors | Yes |
| POST | `/api/v1/quality/backfill-index` | Backfill index | Yes |

### AI Settings & BYOK (10 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/ai/ai-preferences` | Get AI prefs | Yes |
| PUT | `/api/v1/ai/ai-preferences` | Update AI prefs | Yes |
| GET | `/api/v1/ai/provider-keys` | List provider keys | Yes |
| POST | `/api/v1/ai/provider-keys` | Add provider key (BYOK) | Yes |
| DELETE | `/api/v1/ai/provider-keys/{provider}` | Remove key | Yes |
| POST | `/api/v1/ai/provider-keys/{provider}/validate` | Validate key | Yes |
| GET | `/api/v1/ai/ai-usage` | Get usage | Yes |
| GET | `/api/v1/ai/ai-usage/summary` | Usage summary | Yes |
| GET | `/api/v1/ai/ai-budget` | Budget status | Yes |
| GET | `/api/v1/ai/available-models` | Available models | Yes |

### Webhooks & Integrations (12 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/webhooks/sentry` | Sentry webhook | API Key |
| POST | `/api/v1/webhooks/datadog` | Datadog webhook | API Key |
| POST | `/api/v1/webhooks/fullstory` | FullStory webhook | API Key |
| POST | `/api/v1/webhooks/logrocket` | LogRocket webhook | API Key |
| POST | `/api/v1/webhooks/newrelic` | New Relic webhook | API Key |
| POST | `/api/v1/webhooks/bugsnag` | Bugsnag webhook | API Key |
| POST | `/api/v1/webhooks/github-actions` | GitHub Actions | API Key |
| POST | `/api/v1/webhooks/coverage` | Coverage webhook | API Key |
| POST | `/api/v1/webhooks/rollbar` | Rollbar webhook | API Key |
| POST | `/api/v1/webhooks/gitlab-ci` | GitLab CI | API Key |
| POST | `/api/v1/webhooks/circleci` | CircleCI | API Key |
| POST | `/api/v1/webhooks/test-results` | Test results | API Key |
| POST | `/api/v1/webhooks/github` | GitHub webhook | Signature |

### Recording & Export (13 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/recording/upload` | Upload recording | Yes |
| POST | `/api/v1/recording/convert` | Convert to test | Yes |
| GET | `/api/v1/recording/replay/{recording_id}` | Replay recording | Yes |
| POST | `/api/v1/recording/snippet` | Generate snippet | Yes |
| GET | `/api/v1/recording/recordings` | List recordings | Yes |
| GET | `/api/v1/recording/list` | List (alias) | Yes |
| DELETE | `/api/v1/recording/{recording_id}` | Delete recording | Yes |
| POST | `/api/v1/export/parameterized/generate` | Export param tests | Yes |
| GET | `/api/v1/export/languages` | Export languages | Yes |
| POST | `/api/v1/export/preview` | Export preview | Yes |
| POST | `/api/v1/export/generate` | Generate export | Yes |
| POST | `/api/v1/export/bulk` | Bulk export | Yes |

### Reports & Artifacts (18 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/reports` | List reports | Yes |
| POST | `/api/v1/reports` | Create report | Yes |
| GET | `/api/v1/reports/{report_id}` | Get report | Yes |
| PUT | `/api/v1/reports/{report_id}` | Update report | Yes |
| PATCH | `/api/v1/reports/{report_id}` | Partial update | Yes |
| DELETE | `/api/v1/reports/{report_id}` | Delete report | Yes |
| GET | `/api/v1/reports/{report_id}/download` | Download report | Yes |
| GET | `/api/v1/projects/{project_id}/reports` | Project reports | Yes |
| POST | `/api/v1/test-runs/{test_run_id}/report` | Create run report | Yes |
| GET | `/api/v1/artifacts/{artifact_id}` | Get artifact | Yes |
| GET | `/api/v1/artifacts/{artifact_id}/url` | Get signed URL | Yes |
| GET | `/api/v1/artifacts/{artifact_id}/raw` | Raw artifact | Yes |
| GET | `/api/v1/artifacts/` | List artifacts | Yes |
| POST | `/api/v1/artifacts/videos/upload-url` | Video upload URL | Yes |
| POST | `/api/v1/artifacts/videos/confirm` | Confirm upload | Yes |
| GET | `/api/v1/artifacts/videos/{artifact_id}` | Get video | Yes |
| GET | `/api/v1/artifacts/videos/{artifact_id}/url` | Video URL | Yes |
| POST | `/api/v1/artifacts/resolve` | Resolve artifact | Yes |

### Notifications (26 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/notifications/slack/test` | Test Slack | Yes |
| POST | `/api/v1/notifications/slack/configure` | Configure Slack | Yes |
| GET | `/api/v1/notifications/slack/status` | Slack status | Yes |
| POST | `/api/v1/notifications/slack/test-result` | Send test result | Yes |
| POST | `/api/v1/notifications/slack/failure-alert` | Failure alert | Yes |
| POST | `/api/v1/notifications/slack/schedule-reminder` | Schedule reminder | Yes |
| POST | `/api/v1/notifications/slack/quality-report` | Quality report | Yes |
| POST | `/api/v1/notifications/slack/message` | Custom message | Yes |
| POST | `/api/v1/notifications/channels` | Create channel | Yes |
| GET | `/api/v1/notifications/channels` | List channels | Yes |
| GET | `/api/v1/notifications/channels/{channel_id}` | Get channel | Yes |
| PATCH | `/api/v1/notifications/channels/{channel_id}` | Update channel | Yes |
| DELETE | `/api/v1/notifications/channels/{channel_id}` | Delete channel | Yes |
| POST | `/api/v1/notifications/channels/{channel_id}/test` | Test channel | Yes |
| POST | `/api/v1/notifications/rules` | Create rule | Yes |
| GET | `/api/v1/notifications/rules` | List rules | Yes |
| GET | `/api/v1/notifications/rules/{rule_id}` | Get rule | Yes |
| PATCH | `/api/v1/notifications/rules/{rule_id}` | Update rule | Yes |
| DELETE | `/api/v1/notifications/rules/{rule_id}` | Delete rule | Yes |
| GET | `/api/v1/notifications/logs` | Notification logs | Yes |
| GET | `/api/v1/notifications/event-types` | Event types | Yes |
| GET | `/api/v1/notifications` | User notifications | Yes |
| GET | `/api/v1/notifications/unread-count` | Unread count | Yes |
| PUT | `/api/v1/notifications/{notification_id}/read` | Mark read | Yes |
| PUT | `/api/v1/notifications/mark-all-read` | Mark all read | Yes |
| GET | `/api/v1/notifications/preferences` | Get prefs | Yes |
| PUT | `/api/v1/notifications/preferences` | Update prefs | Yes |

### Collaboration (10 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/collaboration/presence` | Update presence | Yes |
| GET | `/api/v1/collaboration/presence/{workspace_id}` | Get presence | Yes |
| DELETE | `/api/v1/collaboration/presence/{workspace_id}/{user_id}` | Remove presence | Yes |
| POST | `/api/v1/collaboration/comments` | Create comment | Yes |
| GET | `/api/v1/collaboration/comments/{test_id}` | Get comments | Yes |
| PATCH | `/api/v1/collaboration/comments/{comment_id}` | Update comment | Yes |
| DELETE | `/api/v1/collaboration/comments/{comment_id}` | Delete comment | Yes |
| POST | `/api/v1/collaboration/comments/{comment_id}/reactions` | Add reaction | Yes |
| POST | `/api/v1/collaboration/lock/{test_id}` | Lock test | Yes |
| DELETE | `/api/v1/collaboration/lock/{lock_id}` | Unlock test | Yes |

### Self-Healing (8 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/healing/organizations/{org_id}/config` | Get config | Yes |
| PUT | `/api/v1/healing/organizations/{org_id}/config` | Update config | Yes |
| GET | `/api/v1/healing/organizations/{org_id}/patterns` | List patterns | Yes |
| DELETE | `/api/v1/healing/organizations/{org_id}/patterns/{pattern_id}` | Delete pattern | Yes |
| GET | `/api/v1/healing/organizations/{org_id}/stats` | Healing stats | Yes |
| GET | `/api/v1/healing/organizations/{org_id}/pending-approvals` | Pending | Yes |
| POST | `/api/v1/healing/organizations/{org_id}/approve/{pattern_id}` | Approve | Yes |
| POST | `/api/v1/healing/organizations/{org_id}/reject/{pattern_id}` | Reject | Yes |

### Audit & Compliance (4 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/audit/organizations/{org_id}/logs` | Audit logs | Yes |
| GET | `/api/v1/audit/organizations/{org_id}/summary` | Audit summary | Yes |
| GET | `/api/v1/audit/organizations/{org_id}/export` | Export logs | Yes |
| GET | `/api/v1/audit/organizations/{org_id}/actions` | Action types | Yes |

### Streaming & Real-time (10 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| POST | `/api/v1/streaming/test` | Stream test | Yes |
| POST | `/api/v1/streaming/chat` | Stream chat | Yes |
| GET | `/api/v1/streaming/status/{thread_id}` | Stream status | Yes |
| POST | `/api/v1/streaming/resume/{thread_id}` | Resume stream | Yes |
| DELETE | `/api/v1/streaming/cancel/{thread_id}` | Cancel stream | Yes |
| POST | `/api/v1/chat/message` | Chat message | Yes |
| POST | `/api/v1/chat/stream` | Stream chat | Yes |
| GET | `/api/v1/chat/history/{thread_id}` | Chat history | Yes |
| GET | `/api/v1/chat/threads` | List threads | Yes |
| DELETE | `/api/v1/chat/history/{thread_id}` | Delete history | Yes |
| DELETE | `/api/v1/chat/cancel/{thread_id}` | Cancel chat | Yes |

### Time Travel & Debugging (7 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/time-travel/checkpoints` | List checkpoints | Yes |
| GET | `/api/v1/time-travel/history/{thread_id}` | State history | Yes |
| GET | `/api/v1/time-travel/state/{thread_id}/{checkpoint_id}` | Get state | Yes |
| POST | `/api/v1/time-travel/replay` | Replay from checkpoint | Yes |
| POST | `/api/v1/time-travel/fork` | Fork execution | Yes |
| GET | `/api/v1/time-travel/compare/{thread_id_1}/{thread_id_2}` | Compare states | Yes |
| GET | `/api/v1/time-travel/threads` | List threads | Yes |
| DELETE | `/api/v1/time-travel/thread/{thread_id}` | Delete thread | Yes |

### MCP Sessions (8 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/mcp/connections` | List connections | Yes |
| GET | `/api/v1/mcp/connections/{connection_id}` | Get connection | Yes |
| DELETE | `/api/v1/mcp/connections/{connection_id}` | Remove connection | Yes |
| GET | `/api/v1/mcp/connections/{connection_id}/activity` | Get activity | Yes |
| GET | `/api/v1/mcp/stats` | MCP stats | Yes |
| POST | `/api/v1/mcp/connections/register` | Register (internal) | Yes |
| POST | `/api/v1/mcp/connections/activity` | Log activity | Yes |
| GET | `/api/v1/mcp/auth/pending` | Pending auth | Yes |

### Infrastructure Optimizer (8 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/infra/recommendations` | Get recommendations | Yes |
| GET | `/api/v1/infra/cost-overview` | Cost overview | Yes |
| GET | `/api/v1/infra/cost-report` | Cost report | Yes |
| GET | `/api/v1/infra/forecast` | Demand forecast | Yes |
| GET | `/api/v1/infra/anomalies` | Anomalies | Yes |
| POST | `/api/v1/infra/recommendations/{recommendation_id}/apply` | Apply recommendation | Yes |
| GET | `/api/v1/infra/savings-summary` | Savings summary | Yes |
| GET | `/api/v1/infra/snapshot` | Infra snapshot | Yes |

### Approvals & Sync (9 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/api/v1/approvals/pending` | Pending approvals | Yes |
| GET | `/api/v1/approvals/pending/{thread_id}` | Get pending | Yes |
| POST | `/api/v1/approvals/approve` | Approve | Yes |
| POST | `/api/v1/approvals/resume/{thread_id}` | Resume | Yes |
| GET | `/api/v1/approvals/state/{thread_id}` | Get state | Yes |
| PATCH | `/api/v1/approvals/state/{thread_id}` | Update state | Yes |
| DELETE | `/api/v1/approvals/{thread_id}` | Delete | Yes |
| GET | `/api/v1/approvals/config` | Config | Yes |
| POST | `/api/v1/sync/push` | Sync push | Yes |
| GET | `/api/v1/sync/pull` | Sync pull | Yes |
| GET | `/api/v1/sync/status/{project_id}` | Sync status | Yes |
| POST | `/api/v1/sync/resolve` | Resolve conflicts | Yes |
| POST | `/api/v1/sync/track` | Track changes | Yes |

### Health & Supervisor (8 endpoints)

| Method | Path | Description | Auth Required |
|--------|------|-------------|---------------|
| GET | `/health` | Health check | No |
| GET | `/health/services` | Service health | No |
| GET | `/ready` | Readiness check | No |
| GET | `/api/v1/orchestrator/supervisor/agents` | List agents | Yes |
| GET | `/api/v1/orchestrator/supervisor/jobs` | List jobs | Yes |
| POST | `/api/v1/orchestrator/supervisor/resume/{thread_id}` | Resume job | Yes |
| DELETE | `/api/v1/orchestrator/supervisor/{thread_id}` | Cancel job | Yes |

---

## Authentication Mechanisms

### 1. API Key Authentication

- **Header**: `X-API-Key: argus_sk_<hash>`
- **Prefix**: `argus_sk_` (32 characters)
- **Storage**: SHA-256 hashed in database
- **Scopes**: Organization-level, configurable permissions
- **Rate Limit**: Configurable per key

### 2. JWT Bearer Token

- **Header**: `Authorization: Bearer <token>`
- **Algorithm**: HS256
- **Expiration**: 24 hours (access), 30 days (refresh)
- **Claims**: `sub` (user_id), `org` (organization_id), `roles`, `scopes`, `jti`
- **Revocation**: JTI-based blacklist

### 3. Clerk JWT (Primary for Web)

- **JWKS Endpoint**: `https://api.clerk.com/v1/jwks`
- **Verification**: RS256 with cached public keys
- **Cache TTL**: 1 hour (JWKS), 5 minutes (user info)
- **User lookup**: Clerk Backend API

### 4. OAuth2 Device Authorization Grant (RFC 8628)

- **Flow**: CLI/MCP tools authenticate via browser
- **Endpoints**: `/api/v1/auth/device/*`
- **Code Format**: `XXXX-XXXX` (no ambiguous characters: I, O, 0, 1)
- **Expiration**: 10 minutes
- **Polling Interval**: 5 seconds

### 5. Service Account Tokens

- **Purpose**: Internal service-to-service auth
- **Scopes**: Full access or limited by configuration
- **No expiration**: Long-lived for automation

---

## User Roles & Permissions

### Organization-Level Roles

| Role | Description | Key Permissions |
|------|-------------|-----------------|
| **owner** | Full control, can delete org | All permissions including `org:delete`, `admin:full_access` |
| **admin** | Administrative access | All except `org:delete`, `admin:impersonate` |
| **member** | Standard user | Read/write tests, execute, view results |
| **viewer** | Read-only access | Read organization, projects, tests, results |

### Project-Level Roles

| Role | Description | Key Permissions |
|------|-------------|-----------------|
| **project_admin** | Project management | Manage members, settings, full test control |
| **project_member** | Contributor | Read/write tests, execute |
| **project_viewer** | Observer | Read-only project access |

### Special Roles

| Role | Description | Use Case |
|------|-------------|----------|
| **billing_admin** | Billing management | `org:manage_billing` only |
| **security_admin** | Security oversight | `audit:*`, `api_key:*` |
| **service_account** | Automated access | API integrations |
| **api_user** | API-only access | Webhook consumers |

### Permission Matrix

| Permission | Owner | Admin | Member | Viewer |
|------------|-------|-------|--------|--------|
| `org:read` | ✓ | ✓ | ✓ | ✓ |
| `org:write` | ✓ | ✓ | - | - |
| `org:delete` | ✓ | - | - | - |
| `org:manage_members` | ✓ | ✓ | - | - |
| `org:manage_billing` | ✓ | - | - | - |
| `project:write` | ✓ | ✓ | ✓ | - |
| `project:delete` | ✓ | ✓ | - | - |
| `test:execute` | ✓ | ✓ | ✓ | - |
| `test:approve` | ✓ | ✓ | - | - |
| `api_key:create` | ✓ | ✓ | - | - |
| `api_key:rotate` | ✓ | ✓ | - | - |
| `audit:read` | ✓ | ✓ | - | - |
| `healing:configure` | ✓ | ✓ | - | - |

---

## Security Controls

### Network Security

| Control | Implementation | Notes |
|---------|----------------|-------|
| TLS 1.3 | Enforced via HSTS | 1-year max-age |
| CORS | Allowlist-based | Configurable per environment |
| Rate Limiting | 60 req/min default | Configurable per endpoint |
| IP Allowlisting | Available for enterprise | Not enforced by default |

### Application Security

| Control | Implementation | Location |
|---------|----------------|----------|
| CSP | Strict policy | Dashboard (`next.config.ts`) |
| X-Frame-Options | DENY | Backend middleware |
| X-Content-Type-Options | nosniff | Backend middleware |
| Referrer-Policy | strict-origin-when-cross-origin | Both frontend/backend |
| Permissions-Policy | Restrictive | Backend middleware |

### Data Security

| Control | Implementation | Notes |
|---------|----------------|-------|
| Row-Level Security | PostgreSQL RLS | All tables |
| Encryption at Rest | Supabase managed | AES-256 |
| Encryption in Transit | TLS 1.3 | All connections |
| BYOK Encryption | AES-256-GCM + HKDF | Per-user DEKs, KEK in Cloudflare |
| Signed URLs | Time-limited (15 min) | Artifact access |

### Authentication Security

| Control | Implementation | Notes |
|---------|----------------|-------|
| Password Hashing | Clerk-managed | bcrypt |
| JWT Signing | HS256 | Configurable to RS256 |
| API Key Hashing | SHA-256 | Prefix for identification |
| Session Management | Short-lived + refresh | 24h access, 30d refresh |
| MFA | Clerk-managed | TOTP available |

### Audit & Monitoring

| Control | Implementation | Notes |
|---------|----------------|-------|
| Audit Logging | All mutations logged | Immutable records |
| Error Tracking | Sentry integration | PII redacted |
| Structured Logging | structlog | JSON format |

---

## Testing Scope

### In Scope

1. **All 320 API endpoints** listed above
2. **Authentication bypass** attempts
3. **Authorization bypass** (IDOR, privilege escalation)
4. **Multi-tenant isolation** (cross-organization access)
5. **Input validation** (injection attacks)
6. **Business logic flaws**
7. **Rate limiting bypass**
8. **Session management**
9. **API key security**
10. **File upload/download** (artifacts)
11. **Webhook signature validation**
12. **SSE/WebSocket security**
13. **BYOK encryption implementation**

### Out of Scope

1. **Third-party services**: Clerk, Supabase infrastructure, Cloudflare infrastructure
2. **Physical security**
3. **Social engineering**
4. **DoS/DDoS attacks**
5. **Supply chain attacks** on dependencies
6. **Client-side browser extensions** (Chrome/Firefox extension)

### Testing Credentials

Contact security team for:
- Test organization with all role types
- API keys with various permission levels
- Device auth test accounts

---

## Attack Surface Analysis

### Critical Attack Vectors

1. **IDOR via organization_id/project_id/test_id**
   - All CRUD operations use resource IDs
   - RLS should prevent cross-tenant access
   - Test: Attempt to access resources from other organizations

2. **JWT Token Manipulation**
   - Modify `org` claim to access other organizations
   - Modify `roles` claim to escalate privileges
   - Test: Token forgery with weak/known secrets

3. **API Key Enumeration**
   - Prefix `argus_sk_` is known
   - Test: Brute force key space
   - Test: Timing attacks on key validation

4. **Device Auth Code Brute Force**
   - 8-character user code (22 alphabet characters)
   - ~14 million combinations
   - Test: Rate limiting effectiveness

5. **Webhook Signature Bypass**
   - GitHub webhooks use HMAC-SHA256
   - Other webhooks use API key auth
   - Test: Signature validation edge cases

6. **File Upload Attacks**
   - Recording uploads (recordings, test data)
   - Artifact uploads (videos, screenshots)
   - Test: Malicious file types, path traversal

7. **SSE/Streaming Injection**
   - Real-time test execution streams
   - Chat streaming responses
   - Test: Event injection, resource exhaustion

8. **BYOK Key Extraction**
   - User-provided API keys stored encrypted
   - DEK/KEK envelope encryption
   - Test: Key material exposure, decryption oracle

### High-Value Targets

1. **`/api/v1/ai/provider-keys`** - BYOK API keys
2. **`/api/v1/organizations/{org_id}/keys`** - Platform API keys
3. **`/api/v1/auth/device/*`** - Authentication flow
4. **`/api/v1/audit/organizations/{org_id}/export`** - Audit log exfiltration
5. **`/api/v1/webhooks/*`** - External integrations

---

## Recommended Testing Approach

### Phase 1: Reconnaissance
- OpenAPI spec enumeration (`/openapi.json`)
- Authentication mechanism fingerprinting
- Rate limit mapping

### Phase 2: Authentication Testing
- Device auth flow analysis
- JWT token security
- API key rotation/revocation
- Session handling

### Phase 3: Authorization Testing
- IDOR across all resources
- Role escalation attempts
- Cross-organization access
- Project-level isolation

### Phase 4: Input Validation
- SQL injection (unlikely with SQLAlchemy + RLS)
- NoSQL injection (N/A - PostgreSQL only)
- Command injection via test execution
- XSS via stored content (test names, descriptions)

### Phase 5: Business Logic
- Billing bypass
- Feature flag manipulation
- Resource exhaustion
- Race conditions in concurrent operations

### Phase 6: Data Security
- Artifact access control
- BYOK encryption validation
- Signed URL security
- Export functionality

---

## Contact Information

**Security Team**: security@heyargus.ai
**Bug Bounty**: TBD
**Emergency Contact**: TBD

---

*Document prepared for authorized penetration testing engagement.*
